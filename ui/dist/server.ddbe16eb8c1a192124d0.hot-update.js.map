{"version":3,"sources":["webpack:///./src/IssueList.jsx"],"names":["SECTION_SIZE","PageLink","params","page","activePage","children","set","React","cloneElement","disabled","search","toString","IssueList","Component","fetchData","match","showError","URLSearchParams","vars","hasSelection","selectedId","get","status","effortMin","parseInt","Number","isNaN","effortMax","id","idInt","query","data","graphQLFetch","constructor","initialData","store","issueList","issues","pages","issue","selectedIssue","state","closeIssue","bind","deleteIssue","componentDidMount","loadData","componentDidUpdate","prevProps","location","prevSearch","prevId","props","setState","index","prevState","newList","issueUpdate","pathname","history","showSuccess","issueDelete","push","splice","undoMessage","restoreIssue","render","startPage","Math","floor","endPage","prevSection","nextSection","items","i","min","IssueListWithToast","withToast"],"mappings":";;;;;;;;;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,MAAMA,YAAY,GAAG,CAArB;;AACA,SAASC,QAAT,CAAkB;AAChBC,QADgB;AACRC,MADQ;AACFC,YADE;AACUC;AADV,CAAlB,EAEG;AACDH,QAAM,CAACI,GAAP,CAAW,MAAX,EAAmBH,IAAnB;AACA,MAAIA,IAAI,KAAK,CAAb,EAAgB,oBAAOI,4CAAK,CAACC,YAAN,CAAmBH,QAAnB,EAA6B;AAAEI,YAAQ,EAAE;AAAZ,GAA7B,CAAP;AAChB,sBACE,2DAAC,oEAAD;AACE,YAAQ,EAAE,MAAMN,IAAI,KAAKC,UAD3B;AAEE,MAAE,EAAE;AAAEM,YAAM,EAAG,IAAGR,MAAM,CAACS,QAAP,EAAkB;AAAhC;AAFN,KAIGN,QAJH,CADF;AAQD;;AAED,MAAMO,SAAN,SAAwBL,4CAAK,CAACM,SAA9B,CAAwC;AACtC,eAAaC,SAAb,CAAuBC,KAAvB,EAA8BL,MAA9B,EAAsCM,SAAtC,EAAiD;AAC/C,UAAMd,MAAM,GAAG,IAAIe,wDAAJ,CAAoBP,MAApB,CAAf;AACA,UAAMQ,IAAI,GAAG;AAAEC,kBAAY,EAAE,KAAhB;AAAuBC,gBAAU,EAAE;AAAnC,KAAb;AACA,QAAIlB,MAAM,CAACmB,GAAP,CAAW,QAAX,CAAJ,EAA0BH,IAAI,CAACI,MAAL,GAAcpB,MAAM,CAACmB,GAAP,CAAW,QAAX,CAAd;AAE1B,UAAME,SAAS,GAAGC,QAAQ,CAACtB,MAAM,CAACmB,GAAP,CAAW,WAAX,CAAD,EAA0B,EAA1B,CAA1B;AACA,QAAI,CAACI,MAAM,CAACC,KAAP,CAAaH,SAAb,CAAL,EAA8BL,IAAI,CAACK,SAAL,GAAiBA,SAAjB;AAC9B,UAAMI,SAAS,GAAGH,QAAQ,CAACtB,MAAM,CAACmB,GAAP,CAAW,WAAX,CAAD,EAA0B,EAA1B,CAA1B;AACA,QAAI,CAACI,MAAM,CAACC,KAAP,CAAaC,SAAb,CAAL,EAA8BT,IAAI,CAACS,SAAL,GAAiBA,SAAjB;AAE9B,UAAM;AAAEzB,YAAM,EAAE;AAAE0B;AAAF;AAAV,QAAqBb,KAA3B;AACA,UAAMc,KAAK,GAAGL,QAAQ,CAACI,EAAD,EAAK,EAAL,CAAtB;;AACA,QAAI,CAACH,MAAM,CAACC,KAAP,CAAaG,KAAb,CAAL,EAA0B;AACxBX,UAAI,CAACC,YAAL,GAAoB,IAApB;AACAD,UAAI,CAACE,UAAL,GAAkBS,KAAlB;AACD;;AAED,QAAI1B,IAAI,GAAGqB,QAAQ,CAACtB,MAAM,CAACmB,GAAP,CAAW,MAAX,CAAD,EAAqB,EAArB,CAAnB;AACA,QAAII,MAAM,CAACC,KAAP,CAAavB,IAAb,CAAJ,EAAwBA,IAAI,GAAG,CAAP;AACxBe,QAAI,CAACf,IAAL,GAAYA,IAAZ;AAEA,UAAM2B,KAAK,GAAI;;;;;;;;;;;;;;;;;;;;;;;MAAf;AAyBA,UAAMC,IAAI,GAAG,MAAMC,gEAAY,CAACF,KAAD,EAAQZ,IAAR,EAAcF,SAAd,CAA/B;AACA,WAAOe,IAAP;AACD;;AAEDE,aAAW,GAAG;AACZ;AACA,UAAMC,WAAW,GAAGC,iDAAK,CAACD,WAAN,IAAqB;AAAEE,eAAS,EAAE;AAAb,KAAzC;AACA,UAAM;AACJA,eAAS,EAAE;AAAEC,cAAF;AAAUC;AAAV,OADP;AAC0BC,WAAK,EAAEC;AADjC,QAEFN,WAFJ;AAGA,WAAOC,iDAAK,CAACD,WAAb;AACA,SAAKO,KAAL,GAAa;AACXJ,YADW;AAEXG,mBAFW;AAGXF;AAHW,KAAb;AAKA,SAAKI,UAAL,GAAkB,KAAKA,UAAL,CAAgBC,IAAhB,CAAqB,IAArB,CAAlB;AACA,SAAKC,WAAL,GAAmB,KAAKA,WAAL,CAAiBD,IAAjB,CAAsB,IAAtB,CAAnB;AACD;;AAEDE,mBAAiB,GAAG;AAClB,UAAM;AAAER;AAAF,QAAa,KAAKI,KAAxB;AACA,QAAIJ,MAAM,IAAI,IAAd,EAAoB,KAAKS,QAAL;AACrB;;AAEDC,oBAAkB,CAACC,SAAD,EAAY;AAC5B,UAAM;AACJC,cAAQ,EAAE;AAAEvC,cAAM,EAAEwC;AAAV,OADN;AAEJnC,WAAK,EAAE;AAAEb,cAAM,EAAE;AAAE0B,YAAE,EAAEuB;AAAN;AAAV;AAFH,QAGFH,SAHJ;AAIA,UAAM;AAAEC,cAAQ,EAAE;AAAEvC;AAAF,OAAZ;AAAwBK,WAAK,EAAE;AAAEb,cAAM,EAAE;AAAE0B;AAAF;AAAV;AAA/B,QAAsD,KAAKwB,KAAjE;;AACA,QAAIF,UAAU,KAAKxC,MAAf,IAAyByC,MAAM,KAAKvB,EAAxC,EAA4C;AAC1C,WAAKkB,QAAL;AACD;AACF;;AAED,QAAMA,QAAN,GAAiB;AACf,UAAM;AAAEG,cAAQ,EAAE;AAAEvC;AAAF,OAAZ;AAAwBK,WAAxB;AAA+BC;AAA/B,QAA6C,KAAKoC,KAAxD;AACA,UAAMrB,IAAI,GAAG,MAAMnB,SAAS,CAACE,SAAV,CAAoBC,KAApB,EAA2BL,MAA3B,EAAmCM,SAAnC,CAAnB;;AACA,QAAIe,IAAJ,EAAU;AACR,WAAKsB,QAAL,CAAc;AACZhB,cAAM,EAAEN,IAAI,CAACK,SAAL,CAAeC,MADX;AAEZG,qBAAa,EAAET,IAAI,CAACQ,KAFR;AAGZD,aAAK,EAAEP,IAAI,CAACK,SAAL,CAAeE;AAHV,OAAd;AAKD;AACF;;AAED,QAAMI,UAAN,CAAiBY,KAAjB,EAAwB;AACtB,UAAMxB,KAAK,GAAI;;;;;MAAf;AAMA,UAAM;AAAEO;AAAF,QAAa,KAAKI,KAAxB;AACA,UAAM;AAAEzB;AAAF,QAAgB,KAAKoC,KAA3B;AACA,UAAMrB,IAAI,GAAG,MAAMC,gEAAY,CAACF,KAAD,EAAQ;AAAEF,QAAE,EAAES,MAAM,CAACiB,KAAD,CAAN,CAAc1B;AAApB,KAAR,EAAkCZ,SAAlC,CAA/B;;AACA,QAAIe,IAAJ,EAAU;AACR,WAAKsB,QAAL,CAAeE,SAAD,IAAe;AAC3B,cAAMC,OAAO,GAAG,CAAC,GAAGD,SAAS,CAAClB,MAAd,CAAhB;AACAmB,eAAO,CAACF,KAAD,CAAP,GAAiBvB,IAAI,CAAC0B,WAAtB;AACA,eAAO;AAAEpB,gBAAM,EAAEmB;AAAV,SAAP;AACD,OAJD;AAKD,KAND,MAMO;AACL,WAAKV,QAAL;AACD;AACF;;AAED,QAAMF,WAAN,CAAkBU,KAAlB,EAAyB;AACvB,UAAMxB,KAAK,GAAI;;MAAf;AAGA,UAAM;AAAEO;AAAF,QAAa,KAAKI,KAAxB;AACA,UAAM;AAAEQ,cAAQ,EAAE;AAAES,gBAAF;AAAYhD;AAAZ,OAAZ;AAAkCiD;AAAlC,QAA8C,KAAKP,KAAzD;AACA,UAAM;AAAExB;AAAF,QAASS,MAAM,CAACiB,KAAD,CAArB;AACA,UAAM;AAAEM,iBAAF;AAAe5C;AAAf,QAA6B,KAAKoC,KAAxC;AACA,UAAMrB,IAAI,GAAG,MAAMC,gEAAY,CAACF,KAAD,EAAQ;AAAEF;AAAF,KAAR,EAAgBZ,SAAhB,CAA/B;;AACA,QAAIe,IAAI,IAAIA,IAAI,CAAC8B,WAAjB,EAA8B;AAC5B,WAAKR,QAAL,CAAeE,SAAD,IAAe;AAC3B,cAAMC,OAAO,GAAG,CAAC,GAAGD,SAAS,CAAClB,MAAd,CAAhB;;AACA,YAAIqB,QAAQ,KAAM,WAAU9B,EAAG,EAA/B,EAAkC;AAChC+B,iBAAO,CAACG,IAAR,CAAa;AAAEJ,oBAAQ,EAAE,SAAZ;AAAuBhD;AAAvB,WAAb;AACD;;AACD8C,eAAO,CAACO,MAAR,CAAeT,KAAf,EAAsB,CAAtB;AACA,eAAO;AAAEjB,gBAAM,EAAEmB;AAAV,SAAP;AACD,OAPD;AAQA,YAAMQ,WAAW,gBACf,yEACI,iBAAgBpC,EAAG,gBADvB,eAEE,2DAAC,sDAAD;AAAQ,eAAO,EAAC,MAAhB;AAAuB,eAAO,EAAE,MAAM,KAAKqC,YAAL,CAAkBrC,EAAlB;AAAtC,gBAFF,CADF;AAQAgC,iBAAW,CAACI,WAAD,CAAX;AACD,KAlBD,MAkBO;AACL,WAAKlB,QAAL;AACD;AACF;;AAED,QAAMmB,YAAN,CAAmBrC,EAAnB,EAAuB;AACrB,UAAME,KAAK,GAAI;;MAAf;AAGA,UAAM;AAAE8B,iBAAF;AAAe5C;AAAf,QAA6B,KAAKoC,KAAxC;AACA,UAAMrB,IAAI,GAAG,MAAMC,gEAAY,CAACF,KAAD,EAAQ;AAAEF;AAAF,KAAR,EAAgBZ,SAAhB,CAA/B;;AACA,QAAIe,IAAJ,EAAU;AACR6B,iBAAW,CAAE,SAAQhC,EAAG,yBAAb,CAAX;AACA,WAAKkB,QAAL;AACD;AACF;;AAEDoB,QAAM,GAAG;AACP,UAAM;AAAE7B;AAAF,QAAa,KAAKI,KAAxB;AACA,QAAIJ,MAAM,IAAI,IAAd,EAAoB,OAAO,IAAP;AACpB,UAAM;AAAEG,mBAAF;AAAiBF;AAAjB,QAA2B,KAAKG,KAAtC;AACA,UAAM;AAAEQ,cAAQ,EAAE;AAAEvC;AAAF;AAAZ,QAA2B,KAAK0C,KAAtC;AAEA,UAAMlD,MAAM,GAAG,IAAIe,wDAAJ,CAAoBP,MAApB,CAAf;AACA,QAAIP,IAAI,GAAGqB,QAAQ,CAACtB,MAAM,CAACmB,GAAP,CAAW,MAAX,CAAD,EAAqB,EAArB,CAAnB;AACA,QAAII,MAAM,CAACC,KAAP,CAAavB,IAAb,CAAJ,EAAwBA,IAAI,GAAG,CAAP;AAExB,UAAMgE,SAAS,GAAGC,IAAI,CAACC,KAAL,CAAW,CAAClE,IAAI,GAAG,CAAR,IAAaH,YAAxB,IAAwCA,YAAxC,GAAuD,CAAzE;AACA,UAAMsE,OAAO,GAAGH,SAAS,GAAGnE,YAAZ,GAA2B,CAA3C;AACA,UAAMuE,WAAW,GAAGJ,SAAS,KAAK,CAAd,GAAkB,CAAlB,GAAsBA,SAAS,GAAGnE,YAAtD;AACA,UAAMwE,WAAW,GAAGF,OAAO,IAAIhC,KAAX,GAAmB,CAAnB,GAAuB6B,SAAS,GAAGnE,YAAvD;AAEA,UAAMyE,KAAK,GAAG,EAAd;;AACA,SAAK,IAAIC,CAAC,GAAGP,SAAb,EAAwBO,CAAC,IAAIN,IAAI,CAACO,GAAL,CAASL,OAAT,EAAkBhC,KAAlB,CAA7B,EAAuDoC,CAAC,IAAI,CAA5D,EAA+D;AAC7DxE,YAAM,CAACI,GAAP,CAAW,MAAX,EAAmBoE,CAAnB;AACAD,WAAK,CAACX,IAAN,eACE,2DAAC,QAAD;AAAU,WAAG,EAAEY,CAAf;AAAkB,cAAM,EAAExE,MAA1B;AAAkC,kBAAU,EAAEC,IAA9C;AAAoD,YAAI,EAAEuE;AAA1D,sBACE,2DAAC,0DAAD,CAAY,IAAZ,QAAkBA,CAAlB,CADF,CADF;AAKD;;AAED,wBACE,2DAAC,4CAAD,CAAO,QAAP,qBACE,2DAAC,qDAAD,qBACE,2DAAC,qDAAD,CAAO,OAAP,qBACE,2DAAC,qDAAD,CAAO,KAAP;AAAa,YAAM;AAAnB,gBADF,CADF,eAIE,2DAAC,qDAAD,CAAO,IAAP;AAAY,iBAAW;AAAvB,oBACE,2DAAC,wDAAD;AAAa,aAAO,EAAC;AAArB,MADF,CAJF,CADF,eASE,2DAAC,uDAAD;AACE,YAAM,EAAErC,MADV;AAEE,gBAAU,EAAE,KAAKK,UAFnB;AAGE,iBAAW,EAAE,KAAKE;AAHpB,MATF,eAcE,2DAAC,wDAAD;AAAa,WAAK,EAAEJ;AAApB,MAdF,eAeE,2DAAC,0DAAD,qBACE,2DAAC,QAAD;AAAU,YAAM,EAAEtC,MAAlB;AAA0B,UAAI,EAAEqE;AAAhC,oBACE,2DAAC,0DAAD,CAAY,IAAZ,QAAkB,GAAlB,CADF,CADF,EAIGE,KAJH,eAKE,2DAAC,QAAD;AAAU,YAAM,EAAEvE,MAAlB;AAA0B,UAAI,EAAEsE;AAAhC,oBACE,2DAAC,0DAAD,CAAY,IAAZ,QAAkB,GAAlB,CADF,CALF,CAfF,CADF;AA2BD;;AApNqC;;AAuNxC,MAAMI,kBAAkB,GAAGC,8DAAS,CAACjE,SAAD,CAApC;AACAgE,kBAAkB,CAAC9D,SAAnB,GAA+BF,SAAS,CAACE,SAAzC;AAEe8D,iFAAf,E","file":"server.ddbe16eb8c1a192124d0.hot-update.js","sourcesContent":["\n/* eslint \"react/jsx-no-undef\": \"off\" */\n\nimport React from 'react';\nimport URLSearchParams from 'url-search-params';\nimport { Panel, Pagination, Button } from 'react-bootstrap';\nimport { LinkContainer } from 'react-router-bootstrap';\nimport IssueFilter from './IssueFilter.jsx';\nimport IssueTable from './IssueTable.jsx';\nimport graphQLFetch from './graphQLFetch.js';\nimport IssueDetail from './IssueDetail.jsx';\nimport withToast from './withToast.jsx';\nimport store from './store.js';\n\nconst SECTION_SIZE = 5;\nfunction PageLink({\n  params, page, activePage, children,\n}) {\n  params.set('page', page);\n  if (page === 0) return React.cloneElement(children, { disabled: true });\n  return (\n    <LinkContainer\n      isActive={() => page === activePage}\n      to={{ search: `?${params.toString()}` }}\n    >\n      {children}\n    </LinkContainer>\n  );\n}\n\nclass IssueList extends React.Component {\n  static async fetchData(match, search, showError) {\n    const params = new URLSearchParams(search);\n    const vars = { hasSelection: false, selectedId: 0 };\n    if (params.get('status')) vars.status = params.get('status');\n\n    const effortMin = parseInt(params.get('effortMin'), 10);\n    if (!Number.isNaN(effortMin)) vars.effortMin = effortMin;\n    const effortMax = parseInt(params.get('effortMax'), 10);\n    if (!Number.isNaN(effortMax)) vars.effortMax = effortMax;\n\n    const { params: { id } } = match;\n    const idInt = parseInt(id, 10);\n    if (!Number.isNaN(idInt)) {\n      vars.hasSelection = true;\n      vars.selectedId = idInt;\n    }\n\n    let page = parseInt(params.get('page'), 10);\n    if (Number.isNaN(page)) page = 1;\n    vars.page = page;\n\n    const query = `query issueList(\n      $status: StatusType\n      $effortMin: Int\n      $effortMax: Int\n      $hasSelection: Boolean!\n      $selectedId: Int!\n      $page: Int\n      ) {\n      issueList (\n        status: $status\n        effortMin: $effortMin\n        effortMax: $effortMax\n        page: $page\n        ) {\n        issues {\n          id title status owner\n          created effort due\n        }\n        pages\n      }\n      issue(id: $selectedId) @include (if : $hasSelection) {\n        id description\n       }\n    }`;\n\n    const data = await graphQLFetch(query, vars, showError);\n    return data;\n  }\n\n  constructor() {\n    super();\n    const initialData = store.initialData || { issueList: {} };\n    const {\n      issueList: { issues, pages }, issue: selectedIssue,\n    } = initialData;\n    delete store.initialData;\n    this.state = {\n      issues,\n      selectedIssue,\n      pages,\n    };\n    this.closeIssue = this.closeIssue.bind(this);\n    this.deleteIssue = this.deleteIssue.bind(this);\n  }\n\n  componentDidMount() {\n    const { issues } = this.state;\n    if (issues == null) this.loadData();\n  }\n\n  componentDidUpdate(prevProps) {\n    const {\n      location: { search: prevSearch },\n      match: { params: { id: prevId } },\n    } = prevProps;\n    const { location: { search }, match: { params: { id } } } = this.props;\n    if (prevSearch !== search || prevId !== id) {\n      this.loadData();\n    }\n  }\n\n  async loadData() {\n    const { location: { search }, match, showError } = this.props;\n    const data = await IssueList.fetchData(match, search, showError);\n    if (data) {\n      this.setState({\n        issues: data.issueList.issues,\n        selectedIssue: data.issue,\n        pages: data.issueList.pages,\n      });\n    }\n  }\n\n  async closeIssue(index) {\n    const query = `mutation issueClose($id: Int!) {\n    issueUpdate(id: $id, changes: { status: Closed }) {\n    id title status owner\n    effort created due description\n    }\n    }`;\n    const { issues } = this.state;\n    const { showError } = this.props;\n    const data = await graphQLFetch(query, { id: issues[index].id }, showError);\n    if (data) {\n      this.setState((prevState) => {\n        const newList = [...prevState.issues];\n        newList[index] = data.issueUpdate;\n        return { issues: newList };\n      });\n    } else {\n      this.loadData();\n    }\n  }\n\n  async deleteIssue(index) {\n    const query = `mutation issueDelete($id: Int!) {\n      issueDelete(id: $id)\n    }`;\n    const { issues } = this.state;\n    const { location: { pathname, search }, history } = this.props;\n    const { id } = issues[index];\n    const { showSuccess, showError } = this.props;\n    const data = await graphQLFetch(query, { id }, showError);\n    if (data && data.issueDelete) {\n      this.setState((prevState) => {\n        const newList = [...prevState.issues];\n        if (pathname === `/issues/${id}`) {\n          history.push({ pathname: '/issues', search });\n        }\n        newList.splice(index, 1);\n        return { issues: newList };\n      });\n      const undoMessage = (\n        <span>\n          {`Deleted issue ${id} successfully.`}\n          <Button bsStyle=\"link\" onClick={() => this.restoreIssue(id)}>\n            UNDO\n          </Button>\n        </span>\n      );\n      showSuccess(undoMessage);\n    } else {\n      this.loadData();\n    }\n  }\n\n  async restoreIssue(id) {\n    const query = `mutation issueRestore($id: Int!) {\n      issueRestore(id: $id)\n    }`;\n    const { showSuccess, showError } = this.props;\n    const data = await graphQLFetch(query, { id }, showError);\n    if (data) {\n      showSuccess(`Issue ${id} restored successfully.`);\n      this.loadData();\n    }\n  }\n\n  render() {\n    const { issues } = this.state;\n    if (issues == null) return null;\n    const { selectedIssue, pages } = this.state;\n    const { location: { search } } = this.props;\n\n    const params = new URLSearchParams(search);\n    let page = parseInt(params.get('page'), 10);\n    if (Number.isNaN(page)) page = 1;\n\n    const startPage = Math.floor((page - 1) / SECTION_SIZE) * SECTION_SIZE + 1;\n    const endPage = startPage + SECTION_SIZE - 1;\n    const prevSection = startPage === 1 ? 0 : startPage - SECTION_SIZE;\n    const nextSection = endPage >= pages ? 0 : startPage + SECTION_SIZE;\n\n    const items = [];\n    for (let i = startPage; i <= Math.min(endPage, pages); i += 1) {\n      params.set('page', i);\n      items.push((\n        <PageLink key={i} params={params} activePage={page} page={i}>\n          <Pagination.Item>{i}</Pagination.Item>\n        </PageLink>\n      ));\n    }\n\n    return (\n      <React.Fragment>\n        <Panel>\n          <Panel.Heading>\n            <Panel.Title toggle>Filter</Panel.Title>\n          </Panel.Heading>\n          <Panel.Body collapsible>\n            <IssueFilter urlBase=\"/issues\" />\n          </Panel.Body>\n        </Panel>\n        <IssueTable\n          issues={issues}\n          closeIssue={this.closeIssue}\n          deleteIssue={this.deleteIssue}\n        />\n        <IssueDetail issue={selectedIssue} />\n        <Pagination>\n          <PageLink params={params} page={prevSection}>\n            <Pagination.Item>{'<'}</Pagination.Item>\n          </PageLink>\n          {items}\n          <PageLink params={params} page={nextSection}>\n            <Pagination.Item>{'>'}</Pagination.Item>\n          </PageLink>\n        </Pagination>\n      </React.Fragment>\n    );\n  }\n}\n\nconst IssueListWithToast = withToast(IssueList);\nIssueListWithToast.fetchData = IssueList.fetchData;\n\nexport default IssueListWithToast;\n"],"sourceRoot":""}